<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Audio Analysis Visualization</title>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <style>
            * {
                font-family: sans-serif;
            }
            .container {
                margin-bottom: 20px;
            }
            .buttons {
                margin-bottom: 20px;
            }
            .chart-container {
                position: relative;
                display: block;
                height: 3500px;
            }
            .chart {
                margin-top: 20px;
                padding: 20px;
                display: none;
                position: absolute;
            }
            .line,
            .onset-line {
                fill: none;
                stroke-width: 3px;
            }
            .axis path,
            .axis line {
                stroke: black;
            }
            .axis text {
                font-size: 12px;
            }
            .toggle-button {
                margin: 5px;
                padding: 5px 10px;
                font-size: 14px;
                cursor: pointer;
                background-color: lightgray;
                border: 1px solid black;
                border-radius: 5px;
            }
        </style>
    </head>
    <body>
        <script>
            function drawChart(data, elementId, color, chartType) {
                const margin = { top: 20, right: 20, bottom: 30, left: 50 },
                    width = 6000 - margin.left - margin.right,
                    height = 3000 - margin.top - margin.bottom;

                const svg = d3
                    .select(`#${elementId}`)
                    .append('svg')
                    .attr('width', width + margin.left + margin.right)
                    .attr('height', height + margin.top + margin.bottom)
                    .append('g')
                    .attr('transform', `translate(${margin.left},${margin.top})`);

                const x = d3.scaleLinear().range([0, width]);
                let y = d3.scaleLinear().range([height, 0]);

                x.domain(d3.extent(data, (d) => d.time));

                if (chartType === 'line') {
                    const minValue = d3.min(data, (d) => d.value) * 0.95;
                    const maxValue = d3.max(data, (d) => d.value) * 1.05;
                    y.domain([minValue, maxValue]);

                    const line = d3
                        .line()
                        .x((d) => x(d.time))
                        .y((d) => y(d.value));

                    svg.append('path').datum(data).attr('class', 'line').style('stroke', color).attr('d', line);
                } else if (chartType === 'onset') {
                    y.domain([0, 1]);
                    data.forEach((d) => {
                        svg.append('line')
                            .attr('x1', x(d.time))
                            .attr('x2', x(d.time))
                            .attr('y1', 0)
                            .attr('y2', height)
                            .attr('stroke', color)
                            .attr('class', 'onset-line');
                    });
                }
            }

            function toggleChart(chartId) {
                console.log(`Toggling chart with ID: ${chartId}`);
                const chart = document.getElementById(chartId);
                if (chart) {
                    if (chart.style.display === 'none' || chart.style.display === '') {
                        chart.style.display = 'block';
                    } else {
                        chart.style.display = 'none';
                    }
                } else {
                    console.log(`Chart with ID ${chartId} not found.`);
                }
            }

            d3.json('audio_analysis_enhanced.json').then(function (allTracksData) {
                Object.keys(allTracksData).forEach((trackName, index) => {
                    const trackData = allTracksData[trackName];
                    const onsetsChartId = `onsets-chart-${index}`;
                    const timbreChartId = `timbre-chart-${index}`;
                    const loudnessChartId = `loudness-chart-${index}`;
                    const chromaChartId = `chroma-chart-${index}`;
                    const tempoChartId = `tempo-chart-${index}`;
                    const spectralCentroidChartId = `spectral-centroid-chart-${index}`;
                    const spectralBandwidthChartId = `spectral-bandwidth-chart-${index}`;
                    const zeroCrossingChartId = `zero-crossing-chart-${index}`;
                    const spectralContrastChartId = `spectral-contrast-chart-${index}`;

                    const containerDIV = d3.select('body').append('div').attr('class', 'container');

                    containerDIV.append('h2').text(trackName);

                    const buttonsDiv = containerDIV.append('div').attr('class', 'buttons');
                    buttonsDiv
                        .append('button')
                        .attr('class', 'toggle-button')
                        .text('Toggle Onsets')
                        .on('click', () => toggleChart(onsetsChartId));
                    buttonsDiv
                        .append('button')
                        .attr('class', 'toggle-button')
                        .text('Toggle Timbre')
                        .on('click', () => toggleChart(timbreChartId));
                    buttonsDiv
                        .append('button')
                        .attr('class', 'toggle-button')
                        .text('Toggle Loudness')
                        .on('click', () => toggleChart(loudnessChartId));
                    buttonsDiv
                        .append('button')
                        .attr('class', 'toggle-button')
                        .text('Toggle Chroma')
                        .on('click', () => toggleChart(chromaChartId));
                    buttonsDiv
                        .append('button')
                        .attr('class', 'toggle-button')
                        .text('Toggle Tempo')
                        .on('click', () => toggleChart(tempoChartId));
                    buttonsDiv
                        .append('button')
                        .attr('class', 'toggle-button')
                        .text('Toggle Spectral Centroid')
                        .on('click', () => toggleChart(spectralCentroidChartId));
                    buttonsDiv
                        .append('button')
                        .attr('class', 'toggle-button')
                        .text('Toggle Spectral Bandwidth')
                        .on('click', () => toggleChart(spectralBandwidthChartId));
                    buttonsDiv
                        .append('button')
                        .attr('class', 'toggle-button')
                        .text('Toggle Zero Crossing Rate')
                        .on('click', () => toggleChart(zeroCrossingChartId));
                    buttonsDiv
                        .append('button')
                        .attr('class', 'toggle-button')
                        .text('Toggle Spectral Contrast')
                        .on('click', () => toggleChart(spectralContrastChartId));

                    const chartContainerDiv = containerDIV.append('div').attr('class', 'chart-container');

                    const onsetsDiv = chartContainerDiv.append('div').attr('id', onsetsChartId).attr('class', 'chart');
                    const timbreDiv = chartContainerDiv.append('div').attr('id', timbreChartId).attr('class', 'chart');
                    const loudnessDiv = chartContainerDiv.append('div').attr('id', loudnessChartId).attr('class', 'chart');
                    const chromaDiv = chartContainerDiv.append('div').attr('id', chromaChartId).attr('class', 'chart');
                    const tempoDiv = chartContainerDiv.append('div').attr('id', tempoChartId).attr('class', 'chart');
                    const spectralCentroidDiv = chartContainerDiv.append('div').attr('id', spectralCentroidChartId).attr('class', 'chart');
                    const spectralBandwidthDiv = chartContainerDiv.append('div').attr('id', spectralBandwidthChartId).attr('class', 'chart');
                    const zeroCrossingDiv = chartContainerDiv.append('div').attr('id', zeroCrossingChartId).attr('class', 'chart');
                    const spectralContrastDiv = chartContainerDiv.append('div').attr('id', spectralContrastChartId).attr('class', 'chart');

                    setTimeout(() => {
                        drawChart(trackData.onsets, onsetsChartId, 'steelblue', 'onset');
                        drawChart(trackData.timbre[0].mfcc1, timbreChartId, 'rgba(50, 205, 50, 0.6)', 'line');
                        drawChart(trackData.loudness, loudnessChartId, 'rgba(255, 215, 0, 0.6)', 'line');
                        drawChart(trackData.chroma[0].chroma1, chromaChartId, 'rgba(255, 0, 255, 0.6)', 'line');
                        drawChart(trackData.tempo, tempoChartId, 'rgba(255, 69, 0, 0.6)', 'line');
                        drawChart(trackData.spectral_centroid, spectralCentroidChartId, 'rgba(0, 128, 128, 0.6)', 'line');
                        drawChart(trackData.spectral_bandwidth, spectralBandwidthChartId, 'rgba(75, 0, 130, 0.6)', 'line');
                        drawChart(trackData.zero_crossing_rate, zeroCrossingChartId, 'rgba(123, 104, 238, 0.6)', 'line');
                        drawChart(trackData.spectral_contrast[0].contrast1, spectralContrastChartId, 'rgba(255, 99, 71, 0.6)', 'line');
                    }, 0);
                });
            });
        </script>
    </body>
</html>
